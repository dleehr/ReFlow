{% extends "base.html" %}
{% load url from future %}
{% load repository_filters %}
{% load breadcrumbs %}

{% block breadcrumbs %}
  <ul class="breadcrumb">
    {% breadcrumb_url 'Home' 'home' %}
    {% breadcrumb_url project.project_name 'view_project' project.id %}
    {% breadcrumb 'Users' %}
  </ul>
{% endblock %}

{% block body %}
  <div class="container">

    <table id="data-table" class="table table-hover">
      <thead>
        <tr>
          <th colspan="50" class="center">
            <div style="position:relative">
              <h4>Users <span class="badge badge-inverse align-top">{{ project_users|length }}</span></h4>

              {% if can_manage_project_users %}
              <div style="position:absolute; right:0;top:0;">
                <a class="btn btn-default btn-sm" href="{% url 'add_user_permissions' project.id %}">
                  Add User
                </a>
              </div>
              {% endif %}
            </div>
          </th>
        </tr>
        <tr>
          <th>Username</th>
          <th>Project Permissions</th>
          <th>Site Permissions</th>
        </tr>
      </thead>
      <tbody>
      {% for user in project_users %}
        <tr>
          <td class="middle">
            {{ user.username }}
          </td>
          <td>
          {%  for user_perm in project|get_user_project_permissions:user %}
            {{ user_perm.permission.name }}<br/>
          {% endfor %}
          {% if can_manage_project_users %}
            <a href="{% url 'manage_project_user' project.id user.id %}">
              Edit
            </a>
          {% endif %}
          </td>
          <td>
          {% for site in project.site_set.all %}
            {{ site.site_name }}<a class="pull-right" href="{% url 'manage_site_user' site.id user.id %}">Edit</a>
            <ul>
            {%  for user_perm in site|get_user_site_permissions:user %}
              <li>{{ user_perm.permission.name }}</li>
            {% endfor %}
            </ul>
            {% if not forloop.last %}<hr>{% endif %}
          {% endfor %}
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}