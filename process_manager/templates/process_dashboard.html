{% extends "base.html" %}
{% load url from future %}
{% load breadcrumbs %}
{% block breadcrumbs %}
  <ul class="breadcrumb">
    {% breadcrumb_url 'Home' 'home' %}
    {% breadcrumb 'Process Dashboard' %}
  </ul>
{% endblock %}
{% block body %}
  <div class="container">

    {% if processes %}
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th colspan="3" class="center">
            <h4>Processes <span class="badge badge-inverse align-top">{{ processes|length }}</span></h4>
          </th>
        </tr>
        <tr>
          <th>Process Name</th>
          <th>Process Description</th>
        </tr>
      </thead>

      <tbody>

      {% for process in processes %}
        <tr>
          <td>
            <a href="{% url 'view_process' process.id %}">{{ process.process_name }}</a>
            {% if user.is_superuser %}
            <span class="pull-right">
            <a class="btn btn-success btn-small" href="{% url 'create_process_request' process.id %}"><i class="icon-plus icon-white"></i> New Request</a>
            </span>
            {% endif %}
          </td>
          <td>
            {{ process.process_description }}
          </td>
        </tr>
      {% endfor %}

      </tbody>
    </table>

    {% else %}
    <p>No processes have been defined.</p>
    {% endif %}
    {% if user.is_superuser %}
    <p>
      <a class="btn btn-success btn-small" href="{% url 'add_process' %}"><i class="icon-plus icon-white"></i> Add Process</a>
    </p>
    <br/>
    {% endif %}

    {% if workers %}
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th colspan="4" class="center">
            <h4>Workers <span class="badge badge-inverse align-top">{{ workers|length }}</span></h4>
          </th>
        </tr>
        <tr>
          <th>Worker Name</th>
          <th>Worker Hostname</th>
          <th>Worker Version</th>
          <th>Worker Processes</th>
        </tr>
      </thead>

      <tbody>

      {% for worker in workers %}
        <tr>
          <td>
            <a href="{% url 'view_worker' worker.id %}">{{ worker.worker_name }}</a>
          </td>
          <td>
            {{ worker.worker_hostname }}
          </td>
          <td>
            {{ worker.worker_version }}
          </td>
          <td>
            {% for wpm in worker.workerprocessmap_set.all %}
              {{ wpm.process.process_name }}
            {% endfor %}
          </td>
        </tr>
      {% endfor %}

      </tbody>
    </table>

    {% else %}
    <p>No workers have been defined.</p>
    {% endif %}
    {% if user.is_superuser %}
    <p>
      <a class="btn btn-success btn-small" href="{% url 'add_worker' %}"><i class="icon-plus icon-white"></i> Add Worker</a>
    </p>
    <br/>
    {% endif %}

    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th class="center">
            <h4><a href="{% url 'process_requests' %}">Process Requests</a></h4>
          </th>
        </tr>
      </thead>
    </table>

  </div>
{% endblock %}