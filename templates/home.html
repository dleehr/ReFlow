{% extends "base.html" %}
{% load url from future %}
{% load staticfiles %}
{% load repository_filters %}
{% load breadcrumbs %}

{% block breadcrumbs %}
  <ul class="breadcrumb">
    {% breadcrumb 'Home' %}
  </ul>
{% endblock %}

{% block toes %}
<script src="{% static 'jquery-ui-1.9.2.custom/js/jquery.tablesorter.min.js' %}"></script>
<script>
  $(function() {
    $("table#project-table").tablesorter({
      sortList: [[0,0]],
      headers: {
        0: { sorter: false},
        2: {sorter: false},
        3: {sorter: false},
      }
    });
  });
</script>

{% endblock %}

{% block body %}
  <div class="container">

    {% if projects %}
    <table id="project-table" class="table table-hover">
      <thead>
        <tr>
          <th colspan="3" class="center">
            <h4>Projects <span class="badge badge-inverse align-top">{{ projects|length }}</span></h4>
          </th>
        </tr>
        <tr>
          <th>Project Name</th>
          <th>Project Permissions</th>
          <th>Site Permissions</th>
        </tr>
      </thead>

      <tbody>

      {% for project in projects %}
        <tr>
          <td>
            <a href="{% url 'view_project' project.id %}">{{ project.project_name }}</a>
          </td>
          <td>
          {%  for user_perm in project|get_user_project_permissions:user %}
            {{ user_perm.permission.name }}<br/>
          {% endfor %}
          </td>
          <td>
          {% for site in project.site_set.all %}
            {%  for user_perm in site|get_user_site_permissions:user %}
              {{ site.site_name }}: {{ user_perm.permission.name }}<br/>
            {% endfor %}
          {% endfor %}
          </td>
        </tr>
      {% endfor %}

      </tbody>
    </table>

    {% else %}
    <p>You do not belong to any projects.</p>
    {% endif %}

  </div>
{% endblock %}